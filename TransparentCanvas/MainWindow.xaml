<Window x:Class="TransparentCanvas.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TransparentCanvas"
        mc:Ignorable="d"
        Title="透明画板" 
        Height="600" Width="800"
        MinHeight="200" MinWidth="300"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize">
    
    <Window.Resources>
        <!-- 按钮样式 -->
        <Style x:Key="TitleBarButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#CCCCCC"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3F3F3F"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="CloseButtonStyle" TargetType="Button" BasedOn="{StaticResource TitleBarButtonStyle}">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E81123"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- 工具栏按钮样式 -->
        <Style x:Key="ToolButtonStyle" TargetType="ToggleButton">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#DDDDDD"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#4A4A4A"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#0078D4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#DDDDDD"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#4A4A4A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 颜色按钮样式 -->
        <Style x:Key="ColorButtonStyle" TargetType="RadioButton">
            <Setter Property="Width" Value="20"/>
            <Setter Property="Height" Value="20"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                BorderBrush="#666666"
                                BorderThickness="1"
                                CornerRadius="10">
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="White"/>
                                <Setter TargetName="border" Property="BorderThickness" Value="2"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 置顶按钮样式 -->
        <Style x:Key="PinButtonStyle" TargetType="ToggleButton">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#CCCCCC"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#3F3F3F"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Foreground" Value="#FFD700"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 页面标签关闭按钮样式 -->
        <Style x:Key="TabCloseButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="14"/>
            <Setter Property="Height" Value="14"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#888888"/>
            <Setter Property="FontSize" Value="9"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="4,0,0,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="7">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#E81123"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <Grid x:Name="MainGrid" 
          MouseEnter="MainGrid_MouseEnter" 
          MouseLeave="MainGrid_MouseLeave">
        <!-- 主边框 -->
        <Border x:Name="MainBorder" 
                BorderBrush="#505050" 
                BorderThickness="1" 
                Background="Transparent"
                CornerRadius="6">
            <Grid>
                <!-- 画布区域 -->
                <Border x:Name="CanvasBorder" 
                        Background="Transparent" 
                        CornerRadius="5" 
                        ClipToBounds="True"
                        MouseEnter="CanvasBorder_MouseEnter"
                        MouseLeave="CanvasBorder_MouseLeave">
                    <InkCanvas x:Name="inkCanvas" 
                               Background="#01FFFFFF"
                               EditingMode="Ink"
                               Cursor="Pen">
                    </InkCanvas>
                </Border>
                
                <!-- 浮动控制栏 -->
                <Border x:Name="FloatingToolbar"
                        VerticalAlignment="Top"
                        HorizontalAlignment="Stretch"
                        Background="Transparent"
                        Opacity="0">
                    <Border.Effect>
                        <DropShadowEffect ShadowDepth="2" Opacity="0.4" BlurRadius="8" Color="#000000"/>
                    </Border.Effect>
                    <StackPanel>
                        <!-- 标题栏 -->
                        <Border Background="#E0252526" 
                                CornerRadius="5,5,0,0"
                                MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                            <Grid Height="28">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- 标题 -->
                                <TextBlock Grid.Column="0" 
                                           Text="透明画板" 
                                           Foreground="#CCCCCC" 
                                           VerticalAlignment="Center" 
                                           Margin="10,0,0,0"
                                           FontSize="11"/>
                                
                                <!-- 窗口控制按钮 -->
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <ToggleButton x:Name="PinButton" 
                                                  Style="{StaticResource PinButtonStyle}"
                                                  ToolTip="置顶"
                                                  Click="PinButton_Click"
                                                  Content="📌"/>
                                    <Button Style="{StaticResource TitleBarButtonStyle}" 
                                            Click="MinimizeButton_Click"
                                            Content="─"/>
                                    <Button Style="{StaticResource CloseButtonStyle}" 
                                            Click="CloseButton_Click"
                                            Content="✕"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                        
                        <!-- 工具栏 -->
                        <Border Background="#E0252526">
                            <StackPanel Orientation="Horizontal" Margin="6,4">
                                <!-- 新建页面按钮 -->
                                <Button x:Name="NewPageButton" 
                                        Style="{StaticResource ActionButtonStyle}"
                                        ToolTip="新建页面 (Ctrl+N)"
                                        Click="NewPageButton_Click"
                                        Content="➕"/>
                                
                                <!-- 保存到 OneNote 按钮 -->
                                <Button x:Name="SaveToOneNoteButton" 
                                        Style="{StaticResource ActionButtonStyle}"
                                        ToolTip="保存到 OneNote (Ctrl+S)"
                                        Click="SaveToOneNoteButton_Click"
                                        Content="💾"/>
                                
                                <Border Width="1" Background="#444" Margin="6,4"/>
                                
                                <!-- 选择模式 -->
                                <ToggleButton x:Name="SelectModeButton" 
                                              Style="{StaticResource ToolButtonStyle}"
                                              IsChecked="True"
                                              ToolTip="选择 (S)"
                                              Click="SelectModeButton_Click"
                                              Content="⬚"/>
                                
                                <!-- 绘画模式 -->
                                <ToggleButton x:Name="DrawModeButton" 
                                              Style="{StaticResource ToolButtonStyle}"
                                              ToolTip="画笔 (D)"
                                              Click="DrawModeButton_Click"
                                              Content="✏️"/>
                                
                                <!-- 文字模式 -->
                                <ToggleButton x:Name="TextModeButton" 
                                              Style="{StaticResource ToolButtonStyle}"
                                              ToolTip="文字 (T)"
                                              Click="TextModeButton_Click"
                                              Content="T"/>
                                
                                <!-- 橡皮擦模式 -->
                                <ToggleButton x:Name="EraserModeButton" 
                                              Style="{StaticResource ToolButtonStyle}"
                                              ToolTip="橡皮擦 (E)"
                                              Click="EraserModeButton_Click"
                                              Content="🧹"/>
                                
                                <Border Width="1" Background="#444" Margin="6,4"/>
                                
                                <!-- 颜色选择 -->
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <RadioButton x:Name="ColorBlack" Style="{StaticResource ColorButtonStyle}" 
                                                 Background="Black" GroupName="Colors" IsChecked="True"
                                                 Checked="Color_Checked" Tag="Black"/>
                                    <RadioButton x:Name="ColorWhite" Style="{StaticResource ColorButtonStyle}" 
                                                 Background="White" GroupName="Colors"
                                                 Checked="Color_Checked" Tag="White"/>
                                    <RadioButton x:Name="ColorRed" Style="{StaticResource ColorButtonStyle}" 
                                                 Background="#E74C3C" GroupName="Colors"
                                                 Checked="Color_Checked" Tag="#E74C3C"/>
                                    <RadioButton x:Name="ColorOrange" Style="{StaticResource ColorButtonStyle}" 
                                                 Background="#E67E22" GroupName="Colors"
                                                 Checked="Color_Checked" Tag="#E67E22"/>
                                    <RadioButton x:Name="ColorYellow" Style="{StaticResource ColorButtonStyle}" 
                                                 Background="#F1C40F" GroupName="Colors"
                                                 Checked="Color_Checked" Tag="#F1C40F"/>
                                    <RadioButton x:Name="ColorGreen" Style="{StaticResource ColorButtonStyle}" 
                                                 Background="#2ECC71" GroupName="Colors"
                                                 Checked="Color_Checked" Tag="#2ECC71"/>
                                    <RadioButton x:Name="ColorBlue" Style="{StaticResource ColorButtonStyle}" 
                                                 Background="#3498DB" GroupName="Colors"
                                                 Checked="Color_Checked" Tag="#3498DB"/>
                                    <RadioButton x:Name="ColorPurple" Style="{StaticResource ColorButtonStyle}" 
                                                 Background="#9B59B6" GroupName="Colors"
                                                 Checked="Color_Checked" Tag="#9B59B6"/>
                                </StackPanel>
                                
                                <Border Width="1" Background="#444" Margin="6,4"/>
                                
                                <!-- 粗细调节 -->
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock Text="粗细:" Foreground="#AAAAAA" VerticalAlignment="Center" Margin="4,0" FontSize="11"/>
                                    <Slider x:Name="StrokeThicknessSlider" 
                                            Width="60" 
                                            Minimum="1" 
                                            Maximum="20" 
                                            Value="3"
                                            VerticalAlignment="Center"
                                            ValueChanged="StrokeThicknessSlider_ValueChanged"/>
                                    <TextBlock x:Name="ThicknessText" 
                                               Text="3" 
                                               Foreground="#AAAAAA" 
                                               VerticalAlignment="Center" 
                                               Width="16"
                                               FontSize="11"
                                               Margin="2,0"/>
                                </StackPanel>
                                
                                <Border Width="1" Background="#444" Margin="6,4"/>
                                
                                <!-- 撤销按钮 -->
                                <Button x:Name="UndoButton" 
                                        Style="{StaticResource ActionButtonStyle}"
                                        ToolTip="撤销 (Ctrl+Z)"
                                        Click="UndoButton_Click"
                                        Content="↩️"/>
                                
                                <!-- 清除按钮 -->
                                <Button x:Name="ClearButton" 
                                        Style="{StaticResource ActionButtonStyle}"
                                        ToolTip="清除画布 (Ctrl+Delete)"
                                        Click="ClearButton_Click"
                                        Content="🗑️"/>
                                
                                <!-- 粘贴图片按钮 -->
                                <Button x:Name="PasteImageButton" 
                                        Style="{StaticResource ActionButtonStyle}"
                                        ToolTip="粘贴图片 (Ctrl+V)"
                                        Click="PasteImageButton_Click"
                                        Content="📋"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- 页面标签栏 -->
                        <Border Background="#E01E1E1E" CornerRadius="0,0,0,0">
                            <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                                          VerticalScrollBarVisibility="Disabled"
                                          Margin="4,0"
                                          Height="26">
                                <StackPanel x:Name="PageTabsPanel" 
                                            Orientation="Horizontal" 
                                            VerticalAlignment="Center"/>
                            </ScrollViewer>
                        </Border>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
        
        <!-- 调整大小的手柄 -->
        <Thumb x:Name="ResizeLeft" Width="4" HorizontalAlignment="Left" 
               Background="Transparent" Cursor="SizeWE"
               DragDelta="ResizeLeft_DragDelta"/>
        <Thumb x:Name="ResizeRight" Width="4" HorizontalAlignment="Right" 
               Background="Transparent" Cursor="SizeWE"
               DragDelta="ResizeRight_DragDelta"/>
        <Thumb x:Name="ResizeTop" Height="4" VerticalAlignment="Top" 
               Background="Transparent" Cursor="SizeNS"
               DragDelta="ResizeTop_DragDelta"/>
        <Thumb x:Name="ResizeBottom" Height="4" VerticalAlignment="Bottom" 
               Background="Transparent" Cursor="SizeNS"
               DragDelta="ResizeBottom_DragDelta"/>
        <Thumb x:Name="ResizeTopLeft" Width="8" Height="8" 
               HorizontalAlignment="Left" VerticalAlignment="Top"
               Background="Transparent" Cursor="SizeNWSE"
               DragDelta="ResizeTopLeft_DragDelta"/>
        <Thumb x:Name="ResizeTopRight" Width="8" Height="8" 
               HorizontalAlignment="Right" VerticalAlignment="Top"
               Background="Transparent" Cursor="SizeNESW"
               DragDelta="ResizeTopRight_DragDelta"/>
        <Thumb x:Name="ResizeBottomLeft" Width="8" Height="8" 
               HorizontalAlignment="Left" VerticalAlignment="Bottom"
               Background="Transparent" Cursor="SizeNESW"
               DragDelta="ResizeBottomLeft_DragDelta"/>
        <Thumb x:Name="ResizeBottomRight" Width="8" Height="8" 
               HorizontalAlignment="Right" VerticalAlignment="Bottom"
               Background="Transparent" Cursor="SizeNWSE"
               DragDelta="ResizeBottomRight_DragDelta"/>
    </Grid>
</Window>
